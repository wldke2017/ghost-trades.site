<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecureEscrow - Liquidity Banking Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont/tabler-icons.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intro.js/minified/introjs.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/intro.js/minified/intro.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        },
                        success: '#10b981',
                        warning: '#f59e0b',
                        danger: '#ef4444',
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }

        .dark .glass-effect {
            background: rgba(31, 41, 55, 0.9);
        }

        .modal-backdrop {
            backdrop-filter: blur(4px);
        }

        .animate-fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .active-tab {
            background: white;
            color: #1f2937;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .dark .active-tab {
            background: #374151;
            color: white;
        }
    </style>
</head>

<body
    class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 min-h-screen transition-colors duration-300">

    <!-- Header -->
    <header class="glass-effect border-b border-gray-200 dark:border-gray-700 sticky top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-3">
                    <div
                        class="w-10 h-10 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-lg flex items-center justify-center">
                        <img src="icons/wallet.svg" alt="Logo" class="w-6 h-6 filter invert">
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-900 dark:text-white">SecureEscrow</h1>
                        <p class="text-xs text-gray-500 dark:text-gray-400 hidden sm:block">Liquidity Banking
                            Platform</p>
                    </div>
                </div>

                <!-- Desktop Menu -->
                <div class="hidden md:flex items-center space-x-4">
                    <!-- Dark Mode Toggle -->
                    <button onclick="toggleDarkMode()"
                        class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                        <i class="ti ti-sun text-xl text-gray-700 dark:text-gray-300 dark:hidden"></i>
                        <i class="ti ti-moon text-xl text-gray-300 hidden dark:inline-block"></i>
                    </button>

                    <!-- Enhanced User Info Display -->
                    <div
                        class="flex items-center space-x-3 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-gray-800 dark:to-gray-700 px-5 py-3 rounded-xl shadow-md border-2 border-blue-200 dark:border-gray-600">
                        <div
                            class="w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center shadow-lg">
                            <i class="ti ti-user text-white text-xl"></i>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 dark:text-gray-400 font-medium">Welcome back,</p>
                            <p id="current-user-display" class="text-sm font-bold text-gray-900 dark:text-white">
                                Loading...</p>
                        </div>
                        <div id="user-role-badge" class="hidden px-3 py-1 rounded-full text-xs font-bold"></div>
                    </div>

                    <!-- Admin Switcher (Hidden for non-admins) -->
                    <button id="admin-switch-btn" onclick="window.location.href='/escrow/admin.html'"
                        class="hidden flex items-center space-x-2 bg-gradient-to-r from-purple-600 to-pink-600 text-white px-5 py-2.5 rounded-xl font-semibold hover:from-purple-700 hover:to-pink-700 transition shadow-lg hover:shadow-xl transform hover:scale-105">
                        <i class="ti ti-shield-lock"></i>
                        <span>Admin Panel</span>
                    </button>

                    <!-- Onboarding Button -->
                    <button onclick="startOnboarding()"
                        class="flex items-center space-x-2 bg-gradient-to-r from-teal-500 to-emerald-600 text-white px-5 py-2.5 rounded-xl font-semibold hover:from-teal-600 hover:to-emerald-700 transition shadow-lg hover:shadow-xl transform hover:scale-105">
                        <i class="ti ti-help"></i>
                        <span class="hidden lg:inline">Quick Tour</span>
                    </button>

                    <!-- Settings Button -->
                    <button onclick="showSettings()" id="settings-btn"
                        class="flex items-center space-x-2 bg-gradient-to-r from-gray-500 to-gray-600 text-white px-5 py-2.5 rounded-xl font-semibold hover:from-gray-600 hover:to-gray-700 transition shadow-lg hover:shadow-xl transform hover:scale-105">
                        <i class="ti ti-settings"></i>
                        <span>Settings</span>
                    </button>

                    <!-- Logout Button -->
                    <button onclick="logout()"
                        class="flex items-center space-x-2 bg-gradient-to-r from-red-500 to-red-600 text-white px-5 py-2.5 rounded-xl font-semibold hover:from-red-600 hover:to-red-700 transition shadow-lg hover:shadow-xl transform hover:scale-105">
                        <i class="ti ti-logout"></i>
                        <span>Logout</span>
                    </button>
                </div>

                <!-- Mobile Menu Button -->
                <div class="md:hidden flex items-center">
                    <button onclick="toggleMobileMenu()"
                        class="p-2 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none transition">
                        <i class="ti ti-menu-2 text-2xl"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile Menu Dropdown -->
        <div id="mobile-menu"
            class="hidden md:hidden glass-effect border-t border-gray-200 dark:border-gray-700 animate-fade-in">
            <div class="px-4 py-3 space-y-3">
                <!-- Mobile User Info -->
                <div class="flex items-center space-x-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg">
                    <div
                        class="w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="ti ti-user text-white text-xl"></i>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p id="mobile-user-display" class="text-sm font-bold text-gray-900 dark:text-white truncate">
                            Loading...</p>
                        <div id="mobile-role-badge"
                            class="hidden inline-block px-2 py-0.5 rounded-full text-[10px] font-bold mt-1"></div>
                    </div>
                </div>

                <!-- Mobile Actions -->
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="toggleDarkMode()"
                        class="flex items-center justify-center space-x-2 p-3 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 font-medium">
                        <i class="ti ti-sun dark:hidden"></i>
                        <i class="ti ti-moon hidden dark:inline"></i>
                        <span>Theme</span>
                    </button>

                    <button id="mobile-admin-btn" onclick="window.location.href='/escrow/admin.html'"
                        class="hidden flex items-center justify-center space-x-2 p-3 rounded-lg bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-300 font-medium">
                        <i class="ti ti-shield-lock"></i>
                        <span>Admin</span>
                    </button>
                </div>

                <button onclick="showSettings(); toggleMobileMenu()"
                    class="w-full flex items-center justify-center space-x-2 p-3 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 font-medium mb-2">
                    <i class="ti ti-settings"></i>
                    <span>Settings</span>
                </button>

                <button onclick="logout()"
                    class="w-full flex items-center justify-center space-x-2 p-3 rounded-lg bg-red-50 dark:bg-red-900/50 text-red-600 dark:text-red-400 font-semibold hover:bg-red-100 dark:hover:bg-red-900 transition">
                    <i class="ti ti-logout"></i>
                    <span>Logout</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

        <!-- Earnings Dashboard (Middleman Only) -->
        <div id="earnings-dashboard"
            class="hidden bg-gradient-to-br from-emerald-500 to-teal-600 rounded-2xl shadow-xl p-6 mb-8 text-white">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
                        <i class="ti ti-trophy text-3xl"></i>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold">My Earnings</h2>
                        <p class="text-sm text-emerald-100">Performance & Commission Tracker</p>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white bg-opacity-10 backdrop-blur-sm rounded-xl p-4">
                    <div class="flex items-center space-x-2 mb-2">
                        <i class="ti ti-wallet text-xl"></i>
                        <p class="text-sm text-emerald-100">Total Earned</p>
                    </div>
                    <p class="text-3xl font-bold"><span id="earnings-total">0.00</span></p>
                    <p class="text-xs text-emerald-100 mt-1">Lifetime commission</p>
                </div>

                <div class="bg-white bg-opacity-10 backdrop-blur-sm rounded-xl p-4">
                    <div class="flex items-center space-x-2 mb-2">
                        <i class="ti ti-calendar-month text-xl"></i>
                        <p class="text-sm text-emerald-100">This Month</p>
                    </div>
                    <p class="text-3xl font-bold"><span id="earnings-month">0.00</span></p>
                    <p class="text-xs text-emerald-100 mt-1">Current month earnings</p>
                </div>

                <div class="bg-white bg-opacity-10 backdrop-blur-sm rounded-xl p-4">
                    <div class="flex items-center space-x-2 mb-2">
                        <i class="ti ti-check-circle text-xl"></i>
                        <p class="text-sm text-emerald-100">Success Rate</p>
                    </div>
                    <p class="text-3xl font-bold"><span id="earnings-success-rate">0</span>%</p>
                    <p class="text-xs text-emerald-100 mt-1">Completed orders</p>
                </div>

                <div class="bg-white bg-opacity-10 backdrop-blur-sm rounded-xl p-4">
                    <div class="flex items-center space-x-2 mb-2">
                        <i class="ti ti-trending-up text-xl"></i>
                        <p class="text-sm text-emerald-100">Avg Order Value</p>
                    </div>
                    <p class="text-3xl font-bold"><span id="earnings-avg-order">0.00</span></p>
                    <p class="text-xs text-emerald-100 mt-1">Average amount</p>
                </div>

                <div class="bg-white bg-opacity-10 backdrop-blur-sm rounded-xl p-4">
                    <div class="flex items-center space-x-2 mb-2">
                        <i class="ti ti-arrow-down-circle text-xl"></i>
                        <p class="text-sm text-emerald-100 uppercase tracking-wider">Deposited</p>
                    </div>
                    <p class="text-3xl font-bold"><span id="total-deposited">0.00</span></p>
                    <p class="text-xs text-emerald-100 mt-1">Pending: <span id="pending-deposited">0.00</span></p>
                </div>

                <div class="bg-white bg-opacity-10 backdrop-blur-sm rounded-xl p-4">
                    <div class="flex items-center space-x-2 mb-2">
                        <i class="ti ti-arrow-up-circle text-xl"></i>
                        <p class="text-sm text-emerald-100 uppercase tracking-wider">Withdrawn</p>
                    </div>
                    <p class="text-3xl font-bold"><span id="total-withdrawn">0.00</span></p>
                    <p class="text-xs text-emerald-100 mt-1">Pending: <span id="pending-withdrawn">0.00</span></p>
                </div>
            </div>
        </div>

        <!-- My Active Orders (Middleman Only) -->
        <div id="active-orders-section"
            class="hidden bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 mb-8 border border-gray-100 dark:border-gray-700">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center">
                        <i class="ti ti-briefcase text-2xl text-blue-600 dark:text-blue-400"></i>
                    </div>
                    <div>
                        <h2 class="text-xl font-bold text-gray-900 dark:text-white">My Active Orders</h2>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Orders you're currently working on</p>
                    </div>
                </div>
                <span id="active-order-count"
                    class="bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-4 py-2 rounded-lg font-bold">0
                    Active</span>
            </div>

            <div id="active-orders-list" class="space-y-4">
                <!-- Active orders will be loaded here -->
            </div>

            <div id="empty-active-orders" class="hidden text-center py-12">
                <i class="ti ti-briefcase-off text-6xl text-gray-300 dark:text-gray-600 mb-4"></i>
                <p class="text-gray-500 dark:text-gray-400 font-medium">No active orders</p>
                <p class="text-sm text-gray-400 dark:text-gray-500 mt-2">Claim an order from the Available Orders
                    section</p>
            </div>
        </div>

        <!-- Analytics Section -->
        <div
            class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 mb-8 border border-gray-100 dark:border-gray-700">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-purple-100 dark:bg-purple-900 rounded-lg flex items-center justify-center">
                        <i class="ti ti-chart-line text-2xl text-purple-600 dark:text-purple-400"></i>
                    </div>
                    <div>
                        <h2 class="text-xl font-bold text-gray-900 dark:text-white">Analytics Dashboard</h2>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Transaction trends and statistics</p>
                    </div>
                </div>
            </div>

            <!-- Stats Cards -->
            <div id="earnings-dashboard" class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                <div
                    class="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900 dark:to-blue-800 rounded-lg p-4">
                    <p class="text-sm text-blue-700 dark:text-blue-300 font-medium">Total Orders</p>
                    <p class="text-3xl font-bold text-blue-900 dark:text-blue-100 mt-2" id="stat-total-orders">0</p>
                </div>
                <div
                    class="bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900 dark:to-green-800 rounded-lg p-4">
                    <p class="text-sm text-green-700 dark:text-green-300 font-medium">Completed</p>
                    <p class="text-3xl font-bold text-green-900 dark:text-green-100 mt-2" id="stat-completed">0</p>
                </div>
                <div
                    class="bg-gradient-to-br from-yellow-50 to-yellow-100 dark:from-yellow-900 dark:to-yellow-800 rounded-lg p-4">
                    <p class="text-sm text-yellow-700 dark:text-yellow-300 font-medium">Pending</p>
                    <p class="text-3xl font-bold text-yellow-900 dark:text-yellow-100 mt-2" id="stat-pending">0</p>
                </div>
                <div
                    class="bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900 dark:to-purple-800 rounded-lg p-4">
                    <p class="text-sm text-purple-700 dark:text-purple-300 font-medium">Total Commission</p>
                    <p class="text-3xl font-bold text-purple-900 dark:text-purple-100 mt-2"><span
                            id="stat-commission">0.00</span></p>
                </div>
            </div>

            <!-- Charts -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-gray-50 dark:bg-gray-900 rounded-lg p-4">
                    <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Order Status
                        Distribution
                    </h3>
                    <canvas id="statusChart"></canvas>
                </div>
                <div class="bg-gray-50 dark:bg-gray-900 rounded-lg p-4">
                    <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">Transaction Volume</h3>
                    <canvas id="volumeChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Wallet Balance Cards -->
        <div id="balance-cards" class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div
                class="bg-gradient-to-br from-blue-600 to-indigo-700 rounded-2xl shadow-xl p-6 text-white transform transition hover:scale-105">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center space-x-3">
                        <div class="w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
                            <img src="icons/wallet.svg" alt="Wallet" class="w-8 h-8 filter invert">
                        </div>
                        <div>
                            <p class="text-sm text-blue-100 font-medium">Available Balance</p>
                            <p class="text-xs text-blue-200">Ready to use</p>
                        </div>
                    </div>
                </div>
                <div class="mt-4">
                    <p class="text-4xl font-bold"><span id="avail-bal">0.00</span></p>
                    <p class="text-sm text-blue-100 mt-2">Available for transactions</p>
                </div>
                <div class="mt-4 flex space-x-2">
                    <button onclick="showDepositRequestModal()" id="deposit-btn"
                        class="flex-1 bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg font-semibold transition">
                        <i class="ti ti-plus"></i> Deposit
                    </button>
                    <button onclick="showWithdrawalRequestModal()" id="withdraw-btn"
                        class="flex-1 bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg font-semibold transition">
                        <i class="ti ti-minus"></i> Withdraw
                    </button>
                    <button onclick="refreshBalance()"
                        class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg font-semibold transition"
                        title="Refresh Balance">
                        <i class="ti ti-refresh"></i>
                    </button>
                </div>
            </div>

            <div
                class="bg-gradient-to-br from-purple-600 to-pink-600 rounded-2xl shadow-xl p-6 text-white transform transition hover:scale-105">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center space-x-3">
                        <div class="w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
                            <img src="icons/lock.svg" alt="Lock" class="w-8 h-8 filter invert">
                        </div>
                        <div>
                            <p class="text-sm text-purple-100 font-medium">Locked Balance</p>
                            <p class="text-xs text-purple-200">Secured collateral</p>
                        </div>
                    </div>
                </div>
                <div class="mt-4">
                    <p class="text-4xl font-bold"><span id="lock-bal">0.00</span></p>
                    <p class="text-sm text-purple-100 mt-2">Locked in escrow orders</p>
                </div>
                <button onclick="showMyTransactionRequests()"
                    class="mt-4 w-full bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg font-semibold transition">
                    <i class="ti ti-history"></i> My Transaction Requests
                </button>
            </div>
        </div>

        <!-- System Health Cards (Admin Only) -->
        <div id="system-health-section" class="hidden grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl shadow-lg p-6 text-white">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                        <i class="ti ti-wallet text-2xl"></i>
                    </div>
                </div>
                <p class="text-sm opacity-90 mb-1">Total Liquidity</p>
                <p class="text-3xl font-bold">$<span id="system-total-liquidity">0.00</span></p>
                <p class="text-xs opacity-75 mt-2">Sum of all available balances</p>
            </div>

            <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl shadow-lg p-6 text-white">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                        <i class="ti ti-lock text-2xl"></i>
                    </div>
                </div>
                <p class="text-sm opacity-90 mb-1">Total Escrowed</p>
                <p class="text-3xl font-bold">$<span id="system-total-escrowed">0.00</span></p>
                <p class="text-xs opacity-75 mt-2">Sum of all locked balances</p>
            </div>

            <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-2xl shadow-lg p-6 text-white">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                        <i class="ti ti-chart-line text-2xl"></i>
                    </div>
                </div>
                <p class="text-sm opacity-90 mb-1">Projected Commission</p>
                <p class="text-3xl font-bold">$<span id="system-projected-commission">0.00</span></p>
                <p class="text-xs opacity-75 mt-2">5% from all active orders</p>
            </div>
        </div>

        <!-- Admin Master Overview -->
        <div id="admin-overview"
            class="hidden bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 mb-8 border border-gray-100 dark:border-gray-700">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-purple-100 dark:bg-purple-900 rounded-lg flex items-center justify-center">
                        <i class="ti ti-dashboard text-2xl text-purple-600 dark:text-purple-400"></i>
                    </div>
                    <div>
                        <h2 class="text-xl font-bold text-gray-900 dark:text-white">Master Overview</h2>
                        <p class="text-sm text-gray-500 dark:text-gray-400">All wallets and orders at a glance</p>
                    </div>
                </div>
                <div class="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-4 py-2 rounded-lg shadow-md">
                    <div class="flex items-center space-x-2">
                        <i class="ti ti-crown text-xl"></i>
                        <span class="font-bold">ADMIN CONTROL</span>
                    </div>
                </div>
            </div>

            <!-- Wallets Overview -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">All Wallets</h3>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-gray-200 dark:border-gray-700">
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300">
                                    User</th>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300">
                                    Role</th>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300">
                                    Status</th>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300">
                                    Available</th>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300">
                                    Locked</th>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300">
                                    Total</th>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300">
                                    Actions</th>
                            </tr>
                        </thead>
                        <tbody id="wallets-overview-body">
                            <!-- Wallets will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- All Orders Overview -->
            <div>
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">All Orders</h3>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-gray-200 dark:border-gray-700">
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300">
                                    ID</th>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300">
                                    Amount</th>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300">
                                    Status</th>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300">
                                    Buyer</th>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300">
                                    Middleman</th>
                                <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300">
                                    Created</th>
                            </tr>
                        </thead>
                        <tbody id="orders-overview-body">
                            <!-- Orders will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Transaction Requests Section (Admin Only) -->
        <div id="transaction-requests-section"
            class="hidden bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 mb-8 border border-gray-100 dark:border-gray-700">
            <div class="flex items-center space-x-3 mb-6">
                <div class="w-10 h-10 bg-green-100 dark:bg-green-900 rounded-lg flex items-center justify-center">
                    <i class="ti ti-wallet text-2xl text-green-600 dark:text-green-400"></i>
                </div>
                <div>
                    <h2 class="text-xl font-bold text-gray-900 dark:text-white">Transaction Requests</h2>
                    <p class="text-sm text-gray-500 dark:text-gray-400">Pending deposit and withdrawal requests</p>
                </div>
            </div>

            <div id="transaction-requests-list" class="space-y-4">
                <!-- Transaction requests will be loaded here -->
            </div>

            <div id="empty-transaction-requests" class="text-center py-12 hidden">
                <div
                    class="w-20 h-20 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="ti ti-check text-4xl text-green-400"></i>
                </div>
                <p class="text-gray-500 dark:text-gray-400 font-medium">No pending requests</p>
                <p class="text-sm text-gray-400 dark:text-gray-500 mt-1">All requests have been processed!</p>
            </div>
        </div>

        <!-- Audit Trail Section (Admin Only) -->
        <div id="audit-trail-section"
            class="hidden bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 mb-8 border border-gray-100 dark:border-gray-700">
            <div class="flex items-center space-x-3 mb-6">
                <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center">
                    <i class="ti ti-history text-2xl text-blue-600 dark:text-blue-400"></i>
                </div>
                <div>
                    <h2 class="text-xl font-bold text-gray-900 dark:text-white">Audit Trail</h2>
                    <p class="text-sm text-gray-500 dark:text-gray-400">Complete log of all system activities</p>
                </div>
            </div>

            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-gray-200 dark:border-gray-700">
                            <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300">
                                User
                            </th>
                            <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300">
                                Action</th>
                            <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300">
                                Details</th>
                            <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300">
                                Timestamp</th>
                        </tr>
                    </thead>
                    <tbody id="audit-trail-body">
                        <!-- Audit logs will be loaded here -->
                    </tbody>
                </table>

                <div id="empty-audit-trail" class="text-center py-12 hidden">
                    <div
                        class="w-20 h-20 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="ti ti-history text-4xl text-gray-400"></i>
                    </div>
                    <p class="text-gray-500 dark:text-gray-400 font-medium">No activity logs yet</p>
                    <p class="text-sm text-gray-400 dark:text-gray-500 mt-1">Activity logs will appear here</p>
                </div>
            </div>
        </div>

        <!-- Disputed Orders Section (Admin Only) -->
        <div id="disputed-orders"
            class="hidden bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 mb-8 border border-gray-100 dark:border-gray-700">
            <div class="flex items-center space-x-3 mb-6">
                <div class="w-10 h-10 bg-red-100 dark:bg-red-900 rounded-lg flex items-center justify-center">
                    <i class="ti ti-alert-triangle text-2xl text-red-600 dark:text-red-400"></i>
                </div>
                <div>
                    <h2 class="text-xl font-bold text-gray-900 dark:text-white">Disputed Orders</h2>
                    <p class="text-sm text-gray-500 dark:text-gray-400">Resolve disputes and award funds</p>
                </div>
            </div>

            <div id="disputed-orders-list" class="space-y-4">
                <!-- Disputed orders will be loaded here -->
            </div>

            <div id="empty-disputed" class="text-center py-12 hidden">
                <div
                    class="w-20 h-20 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="ti ti-check text-4xl text-green-400"></i>
                </div>
                <p class="text-gray-500 dark:text-gray-400 font-medium">No disputed orders</p>
                <p class="text-sm text-gray-400 dark:text-gray-500 mt-1">All orders are running smoothly!</p>
            </div>
        </div>

        <!-- Create Order Section (Admin Only) -->
        <div id="create-order-section"
            class="hidden bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 mb-8 border border-gray-100 dark:border-gray-700">
            <div class="flex items-center space-x-3 mb-6">
                <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center">
                    <i class="ti ti-circle-plus text-2xl text-blue-600 dark:text-blue-400"></i>
                </div>
                <div>
                    <h2 class="text-xl font-bold text-gray-900 dark:text-white">Create New Escrow Order</h2>
                    <p class="text-sm text-gray-500 dark:text-gray-400">Post a new order for middlemen to claim</p>
                </div>
            </div>

            <!-- Virtual Cash Info -->
            <div
                class="mb-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900 dark:to-indigo-900 rounded-lg border border-blue-200 dark:border-blue-700">
                <div class="flex items-start space-x-3">
                    <i class="ti ti-info-circle text-2xl text-blue-600 dark:text-blue-400 mt-1"></i>
                    <div>
                        <h3 class="font-semibold text-blue-900 dark:text-blue-100 mb-2">ðŸ’° Virtual Cash System</h3>
                        <p class="text-sm text-blue-800 dark:text-blue-200 mb-2">
                            As Admin, you create orders using <strong>virtual cash</strong> - no real money is
                            deducted
                            from your wallet!
                        </p>
                        <ul class="text-xs text-blue-700 dark:text-blue-300 space-y-1 list-disc list-inside">
                            <li>You post an order with any amount (e.g., $1000)</li>
                            <li>Middleman locks their <strong>real collateral</strong> (same amount) to claim it
                            </li>
                            <li>When completed, middleman gets collateral back + 5% commission</li>
                            <li>The payment is virtual - it's tracking the transaction value</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Order Amount
                        ($)</label>
                    <input type="number" id="order-amount" placeholder="Enter amount"
                        class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Description
                        (Optional)</label>
                    <input type="text" id="order-description" placeholder="Order description"
                        class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                </div>
            </div>

            <button onclick="createNewOrder()"
                class="mt-4 w-full md:w-auto bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-8 py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-indigo-700 transition transform hover:scale-105 shadow-lg">
                Post Order
            </button>
        </div>

        <!-- Bulk Create Order Section (Admin Only) -->
        <div id="bulk-order-section"
            class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 mb-8 border border-gray-100 dark:border-gray-700 hidden">
            <div class="flex items-center justify-between mb-6 cursor-pointer" onclick="toggleBulkSection()">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-indigo-100 dark:bg-indigo-900 rounded-lg flex items-center justify-center">
                        <i class="ti ti-layers-intersect text-2xl text-indigo-600 dark:text-indigo-400"></i>
                    </div>
                    <div>
                        <h2 class="text-xl font-bold text-gray-900 dark:text-white">Bulk Order Generator</h2>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Generate multiple random orders at once
                        </p>
                    </div>
                </div>
                <i id="bulk-toggle-icon" class="ti ti-chevron-down text-xl text-gray-400 transition-transform"></i>
            </div>

            <div id="bulk-form-container" class="hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Number of
                            Orders</label>
                        <input type="number" id="bulk-count" placeholder="e.g. 10" min="2" max="50"
                            class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Total Amount
                            ($)</label>
                        <input type="number" id="bulk-total" placeholder="e.g. 1000" min="10"
                            class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Min Order
                            Amount ($)</label>
                        <input type="number" id="bulk-min" placeholder="e.g. 10" min="1"
                            class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Max Order
                            Amount ($)</label>
                        <input type="number" id="bulk-max" placeholder="e.g. 100" min="1"
                            class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500">
                    </div>
                </div>

                <div class="flex space-x-4">
                    <button onclick="previewBulkOrders()"
                        class="flex-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 px-6 py-3 rounded-lg font-semibold hover:bg-gray-200 dark:hover:bg-gray-600 transition">
                        <i class="ti ti-eye"></i> Preview Distribution
                    </button>
                    <button onclick="submitBulkOrders()"
                        class="flex-1 bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-indigo-700 hover:to-purple-700 transition shadow-lg">
                        <i class="ti ti-bolt"></i> Generate & Post
                    </button>
                </div>

                <!-- Preview Area -->
                <div id="bulk-preview" class="mt-6 hidden">
                    <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Preview Orders</h3>
                    <div
                        class="bg-gray-50 dark:bg-gray-900 rounded-lg p-4 max-h-60 overflow-y-auto border border-gray-200 dark:border-gray-700">
                        <div id="bulk-preview-list" class="space-y-2"></div>
                    </div>
                    <div class="mt-2 text-right text-xs text-gray-500">
                        Total Sum: $<span id="bulk-preview-sum">0.00</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Available Orders Section -->
        <div id="available-orders-section"
            class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 mb-8 border border-gray-100 dark:border-gray-700">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-green-100 dark:bg-green-900 rounded-lg flex items-center justify-center">
                        <i class="ti ti-clock text-2xl text-green-600 dark:text-green-400"></i>
                    </div>
                    <div>
                        <h2 class="text-xl font-bold text-gray-900 dark:text-white">Available Escrow Orders</h2>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Pending escrow orders ready to claim</p>
                    </div>
                </div>
                <span
                    class="bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-xs font-semibold px-3 py-1 rounded-full"
                    id="order-count">0 Orders</span>
            </div>

            <!-- Search and Filter -->
            <div class="flex flex-col md:flex-row gap-4 mb-6">
                <div class="flex-1 relative">
                    <i class="ti ti-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    <input type="text" id="order-search" placeholder="Search orders..."
                        class="w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                        onkeyup="filterOrders()">
                </div>
                <select id="order-status-filter" onchange="filterOrders()"
                    class="px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                    <option value="all">All Status</option>
                    <option value="PENDING">Pending</option>
                    <option value="CLAIMED">Claimed</option>
                    <option value="COMPLETED">Completed</option>
                    <option value="DISPUTED">Disputed</option>
                </select>
                <select id="order-amount-filter" onchange="filterOrders()"
                    class="px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                    <option value="all">All Amounts</option>
                    <option value="0-100">$0 - $100</option>
                    <option value="100-500">$100 - $500</option>
                    <option value="500-1000">$500 - $1000</option>
                    <option value="1000+">$1000+</option>
                </select>
            </div>

            <div id="orders-list" class="space-y-4">
                <!-- Orders will be loaded here -->
            </div>

            <div id="empty-orders" class="text-center py-12 hidden">
                <div
                    class="w-20 h-20 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="ti ti-clock text-4xl text-gray-400"></i>
                </div>
                <p class="text-gray-500 dark:text-gray-400 font-medium">No pending orders available</p>
                <p class="text-sm text-gray-400 dark:text-gray-500 mt-1">New orders will appear here</p>
            </div>
        </div>

        <!-- Transaction History -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 border border-gray-100 dark:border-gray-700">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-purple-100 dark:bg-purple-900 rounded-lg flex items-center justify-center">
                        <i class="ti ti-history text-2xl text-purple-600 dark:text-purple-400"></i>
                    </div>
                    <div>
                        <h2 class="text-xl font-bold text-gray-900 dark:text-white">Transaction History</h2>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Completed escrow transactions</p>
                    </div>
                </div>
                <button onclick="exportToCSV()"
                    class="flex items-center space-x-2 bg-green-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-green-700 transition shadow-md">
                    <i class="ti ti-download"></i>
                    <span>Export CSV</span>
                </button>
            </div>

            <!-- Search History -->
            <div class="mb-4">
                <div class="relative">
                    <i class="ti ti-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    <input type="text" id="history-search" placeholder="Search transaction history..."
                        class="w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                        onkeyup="filterHistory()">
                </div>
            </div>

            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-gray-200 dark:border-gray-700">
                            <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300">
                                Order
                                ID</th>
                            <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300">
                                Amount</th>
                            <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300">
                                Commission</th>
                            <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300">
                                Status</th>
                            <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700 dark:text-gray-300">
                                Date
                            </th>
                        </tr>
                    </thead>
                    <tbody id="history-body">
                        <!-- History will be loaded here -->
                    </tbody>
                </table>

                <div id="empty-history" class="text-center py-12 hidden">
                    <div
                        class="w-20 h-20 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="ti ti-history text-4xl text-gray-400"></i>
                    </div>
                    <p class="text-gray-500 dark:text-gray-400 font-medium">No transaction history yet</p>
                    <p class="text-sm text-gray-400 dark:text-gray-500 mt-1">Completed orders will appear here</p>
                </div>

                <!-- Load More Container -->
                <div id="load-more-container" class="hidden">
                    <!-- Load more button will be inserted here -->
                </div>
            </div>
        </div>

    </main>

    <!-- Order Details Modal -->
    <div id="order-modal" class="hidden fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop" onclick="closeOrderModal()"></div>
            <div class="relative bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-2xl w-full p-6 animate-fade-in">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-2xl font-bold text-gray-900 dark:text-white">Order Details</h3>
                    <button onclick="closeOrderModal()"
                        class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition">
                        <i class="ti ti-x text-2xl text-gray-600 dark:text-gray-400"></i>
                    </button>
                </div>
                <div id="order-modal-content" class="space-y-4">
                    <!-- Content will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Dialog -->
    <div id="confirm-dialog" class="hidden fixed inset-0 z-[100] overflow-hidden">
        <div class="fixed inset-0 bg-black/60 backdrop-blur-sm modal-backdrop"></div>
        <div class="flex items-center justify-center min-h-screen p-4 relative">
            <div
                class="bg-white dark:bg-gray-800 rounded-[2rem] shadow-2xl max-w-md w-full p-8 animate-fade-in border border-gray-100 dark:border-gray-700">
                <div class="text-center mb-8">
                    <div
                        class="w-20 h-20 bg-orange-100 dark:bg-orange-900/30 rounded-full flex items-center justify-center mx-auto mb-6">
                        <i class="ti ti-alert-circle text-5xl text-orange-500 animate-pulse"></i>
                    </div>
                    <h3 class="text-2xl font-black text-gray-900 dark:text-white mb-3 tracking-tight"
                        id="confirm-title">Confirm Action</h3>
                    <p class="text-gray-500 dark:text-gray-400 font-medium leading-relaxed" id="confirm-message">Are you
                        sure you want to proceed?</p>
                </div>
                <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4">
                    <button onclick="closeConfirmDialog()"
                        class="flex-1 px-6 py-4 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-2xl font-bold hover:bg-gray-200 dark:hover:bg-gray-600 transition-all">
                        Cancel
                    </button>
                    <button id="confirm-action-btn"
                        class="flex-1 px-6 py-4 bg-orange-500 hover:bg-orange-600 text-white rounded-2xl font-bold transition-all shadow-lg shadow-orange-500/20">
                        Confirm
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Deposit Request Modal -->
    <div id="deposit-request-modal"
        class="hidden fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full animate-fade-in">
            <div class="p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white">Deposit Funds</h3>
                    <button onclick="closeDepositRequestModal()"
                        class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">
                        <i class="ti ti-x text-2xl"></i>
                    </button>
                </div>

                <!-- Payment Method Tabs -->
                <div class="flex mb-6 bg-gray-100 dark:bg-gray-700 rounded-lg p-1">
                    <button type="button" id="manual-deposit-tab" onclick="switchDepositTab('manual')"
                        class="flex-1 py-2 px-4 rounded-md text-sm font-medium transition active-tab">
                        Manual Deposit
                    </button>
                    <button type="button" id="mpesa-deposit-tab" onclick="switchDepositTab('mpesa')"
                        class="flex-1 py-2 px-4 rounded-md text-sm font-medium transition">
                        M-Pesa
                    </button>
                </div>

                <!-- Manual Deposit Form -->
                <form id="deposit-request-form" onsubmit="submitDepositRequest(event)" class="deposit-form">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Amount
                                (USD)</label>
                            <input type="number" id="deposit-amount" step="0.01" min="0.01" required
                                class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500"
                                placeholder="Enter amount">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Payment
                                Screenshot *</label>
                            <input type="file" id="deposit-screenshot" accept="image/*" required
                                class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500">
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Upload proof of payment (max
                                5MB)
                            </p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Notes
                                (Optional)</label>
                            <textarea id="deposit-notes" rows="3"
                                class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500"
                                placeholder="Add any additional information..."></textarea>
                        </div>

                        <div class="bg-blue-50 dark:bg-blue-900 p-3 rounded-lg">
                            <p class="text-xs text-blue-800 dark:text-blue-200">
                                <i class="ti ti-info-circle"></i> Your request will be reviewed by admin. Once
                                approved,
                                funds will be added to your wallet.
                            </p>
                        </div>
                    </div>

                    <div class="flex space-x-3 mt-6">
                        <button type="button" onclick="closeDepositRequestModal()"
                            class="flex-1 px-4 py-3 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg font-semibold hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                            Cancel
                        </button>
                        <button type="submit"
                            class="flex-1 px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg font-semibold hover:from-green-600 hover:to-emerald-700 transition">
                            Submit Request
                        </button>
                    </div>
                </form>

                <!-- M-Pesa Deposit Form -->
                <form id="mpesa-deposit-form" onsubmit="submitMpesaDeposit(event)" class="deposit-form hidden">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Amount
                                (KES)</label>
                            <input type="number" id="mpesa-amount" step="1" min="1" required
                                class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500"
                                placeholder="Enter amount in KES">
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Amount in Kenyan Shillings</p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">M-Pesa
                                Phone
                                Number *</label>
                            <input type="tel" id="mpesa-phone" pattern="254[0-9]{9}" required
                                class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500"
                                placeholder="254XXXXXXXXX">
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Format: 254XXXXXXXXX (without
                                +)
                            </p>
                        </div>

                        <div class="bg-green-50 dark:bg-green-900 p-3 rounded-lg">
                            <p class="text-xs text-green-800 dark:text-green-200">
                                <i class="ti ti-device-mobile"></i> Instant payment via M-Pesa. You'll receive a
                                prompt
                                on your phone to enter your PIN.
                            </p>
                        </div>
                    </div>

                    <div class="flex space-x-3 mt-6">
                        <button type="button" onclick="closeDepositRequestModal()"
                            class="flex-1 px-4 py-3 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg font-semibold hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                            Cancel
                        </button>
                        <button type="submit"
                            class="flex-1 px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg font-semibold hover:from-green-600 hover:to-emerald-700 transition">
                            Pay with M-Pesa
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Withdrawal Request Modal -->
    <div id="withdrawal-request-modal"
        class="hidden fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full animate-fade-in">
            <div class="p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white">Request Withdrawal</h3>
                    <button onclick="closeWithdrawalRequestModal()"
                        class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">
                        <i class="ti ti-x text-2xl"></i>
                    </button>
                </div>

                <form id="withdrawal-request-form" onsubmit="submitWithdrawalRequest(event)">
                    <div class="space-y-4">
                        <div class="bg-gray-50 dark:bg-gray-900 p-4 rounded-lg">
                            <p class="text-sm text-gray-600 dark:text-gray-400">Available Balance</p>
                            <p class="text-2xl font-bold text-gray-900 dark:text-white"><span
                                    id="withdrawal-available-balance">0.00</span></p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Amount
                                (USD)</label>
                            <input type="number" id="withdrawal-amount" step="0.01" min="1.00" required
                                class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500"
                                placeholder="Enter amount">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">M-Pesa Phone
                                Number</label>
                            <input type="tel" id="withdrawal-phone" pattern="254[0-9]{9}" required
                                class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500"
                                placeholder="254XXXXXXXXX">
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Funds will be sent to this M-Pesa
                                number. Format: 254XXXXXXXXX</p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Notes to
                                Admin (Optional)</label>
                            <textarea id="withdrawal-notes" rows="2"
                                class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500"
                                placeholder="Any additional details..."></textarea>
                        </div>

                        <div class="flex items-center space-x-3 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg">
                            <input type="checkbox" id="withdrawal-confirm" required
                                class="w-5 h-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500">
                            <label for="withdrawal-confirm" class="text-xs font-medium text-red-800 dark:text-red-200">
                                I confirm that the M-Pesa number provided is correct. I understand that funds sent to a
                                wrong number cannot be recovered.
                            </label>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Notes
                                (Optional)</label>
                            <textarea id="withdrawal-notes" rows="3"
                                class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500"
                                placeholder="Bank details or withdrawal method..."></textarea>
                        </div>

                        <div class="bg-yellow-50 dark:bg-yellow-900 p-3 rounded-lg">
                            <p class="text-xs text-yellow-800 dark:text-yellow-200">
                                <i class="ti ti-alert-triangle"></i> Your request will be reviewed by admin. Funds
                                will
                                be processed after approval.
                            </p>
                        </div>
                    </div>

                    <div class="flex space-x-3 mt-6">
                        <button type="button" onclick="closeWithdrawalRequestModal()"
                            class="flex-1 px-4 py-3 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg font-semibold hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                            Cancel
                        </button>
                        <button type="submit"
                            class="flex-1 px-4 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg font-semibold hover:from-red-600 hover:to-red-700 transition">
                            Submit Request
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- My Transaction Requests Modal -->
    <div id="my-requests-modal"
        class="hidden fixed inset-0 bg-black bg-opacity-50 modal-backdrop flex items-center justify-center z-50 p-4">
        <div
            class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto animate-fade-in">
            <div class="p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white">My Transaction Requests</h3>
                    <button onclick="closeMyRequestsModal()"
                        class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">
                        <i class="ti ti-x text-2xl"></i>
                    </button>
                </div>

                <div id="my-requests-list" class="space-y-4">
                    <!-- Requests will be loaded here -->
                </div>

                <div id="empty-my-requests" class="text-center py-12 hidden">
                    <div
                        class="w-20 h-20 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="ti ti-inbox text-4xl text-gray-400"></i>
                    </div>
                    <p class="text-gray-500 dark:text-gray-400 font-medium">No requests yet</p>
                    <p class="text-sm text-gray-400 dark:text-gray-500 mt-1">Submit a deposit or withdrawal request
                        to
                        get started</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal Overlay -->
    <div id="settings-modal"
        class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-[60] flex items-center justify-center p-4">
        <div id="settings-dashboard"
            class="bg-white dark:bg-gray-800 rounded-[2rem] shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-gray-100 dark:border-gray-700 animate-fade-in">
            <div class="p-8">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center">
                            <i class="ti ti-settings text-2xl text-gray-600 dark:text-gray-300"></i>
                        </div>
                        <div>
                            <h2 class="text-xl font-bold text-gray-900 dark:text-white">Settings & Security</h2>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Manage your profile and account security
                            </p>
                        </div>
                    </div>
                    <button onclick="closeSettings()"
                        class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">
                        <i class="ti ti-x text-2xl"></i>
                    </button>
                </div>

                <!-- Settings Tabs -->
                <div class="flex border-b border-gray-200 dark:border-gray-700 mb-6">
                    <button onclick="switchSettingsTab('profile')" id="tab-btn-profile"
                        class="px-6 py-3 border-b-2 border-blue-500 text-blue-600 dark:text-blue-400 font-semibold focus:outline-none">
                        <i class="ti ti-user"></i> Profile
                    </button>
                    <button onclick="switchSettingsTab('security')" id="tab-btn-security"
                        class="px-6 py-3 border-b-2 border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 font-medium focus:outline-none transition">
                        <i class="ti ti-lock"></i> Security
                    </button>
                </div>

                <!-- Profile Tab Content -->
                <div id="settings-tab-profile" class="space-y-6">

                    <!-- Profile Tab Content -->
                    <div id="settings-tab-profile" class="space-y-8">

                        <!-- Avatar Section (Centered) -->
                        <div class="flex flex-col items-center justify-center">
                            <div class="relative group">
                                <img id="settings-avatar-preview"
                                    src="https://ui-avatars.com/api/?name=User&background=random"
                                    class="w-32 h-32 rounded-full object-cover border-4 border-gray-200 dark:border-gray-700 shadow-xl">
                                <div class="absolute inset-0 bg-black bg-opacity-50 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition cursor-pointer"
                                    onclick="document.getElementById('avatar-upload').click()">
                                    <i class="ti ti-camera text-white text-3xl"></i>
                                </div>
                                <input type="file" id="avatar-upload" hidden accept="image/*"
                                    onchange="uploadAvatar(this)">
                            </div>
                            <h3 id="profile-display-name" class="mt-4 text-xl font-bold text-gray-900 dark:text-white">
                                Loading...</h3>
                            <p id="profile-display-email" class="text-sm text-gray-500 dark:text-gray-400">
                                loading@example.com
                            </p>
                        </div>

                        <div class="border-t border-gray-200 dark:border-gray-700"></div>

                        <div class="flex items-center space-x-2 text-purple-600 dark:text-purple-400">
                            <i class="ti ti-user text-xl"></i>
                            <h4 class="font-bold">Personal Information</h4>
                        </div>

                        <form onsubmit="updateProfile(event)" class="space-y-6">
                            <div>
                                <label
                                    class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase mb-2">Full
                                    Name</label>
                                <input type="text" id="settings-fullname"
                                    class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 transition">
                            </div>

                            <div>
                                <label
                                    class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase mb-2">Email
                                    Address</label>
                                <input type="email" id="settings-email"
                                    class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 transition">
                            </div>

                            <div>
                                <label
                                    class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase mb-2">Phone
                                    Number</label>
                                <input type="tel" id="settings-phone"
                                    class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 transition">
                            </div>

                            <div>
                                <label
                                    class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase mb-2">Country</label>
                                <input type="text" id="settings-country"
                                    class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 transition">
                            </div>

                            <!-- Hidden fields -->
                            <input type="hidden" id="settings-username">
                            <input type="hidden" id="settings-role">
                            <input type="hidden" id="settings-mpesa">

                            <div class="pt-4">
                                <label
                                    class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase mb-2">Currency
                                    Display</label>
                                <select id="settings-currency"
                                    class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 transition">
                                    <option value="USD">USD ($)</option>
                                    <option value="KES">KES (Ksh)</option>
                                </select>
                            </div>

                            <div class="pt-6">
                                <button type="submit"
                                    class="w-full bg-slate-800 hover:bg-slate-900 dark:bg-slate-700 dark:hover:bg-slate-600 text-white font-bold py-4 rounded-xl transition shadow-lg flex items-center justify-center space-x-2">
                                    <i class="ti ti-device-floppy"></i>
                                    <span>UPDATE PROFILE</span>
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Security Tab Content -->
                    <div id="settings-tab-security" class="hidden space-y-6">
                        <div
                            class="bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4 mb-6">
                            <div class="flex items-start space-x-3">
                                <i class="ti ti-shield-lock text-yellow-600 dark:text-yellow-400 text-xl mt-0.5"></i>
                                <div>
                                    <h4 class="font-bold text-yellow-800 dark:text-yellow-200">Password Requirements
                                    </h4>
                                    <p class="text-sm text-yellow-700 dark:text-yellow-300 mt-1">
                                        For your security, please use a strong password with at least 8 characters.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <form onsubmit="changePassword(event)" class="space-y-4 max-w-md mx-auto">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Current
                                    Password</label>
                                <div class="relative">
                                    <input type="password" id="current-password" required
                                        class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500">
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">New
                                    Password</label>
                                <div class="relative">
                                    <input type="password" id="new-password" required minlength="6"
                                        class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500">
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Confirm
                                    New
                                    Password</label>
                                <div class="relative">
                                    <input type="password" id="confirm-password" required minlength="6"
                                        class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500">
                                </div>
                            </div>

                            <div class="pt-4">
                                <button type="submit"
                                    class="w-full bg-gradient-to-r from-red-500 to-pink-600 hover:from-red-600 hover:to-pink-700 text-white font-bold py-3 px-6 rounded-lg transition shadow-md flex items-center justify-center space-x-2">
                                    <i class="ti ti-lock"></i>
                                    <span>Update Password</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Toast Notification Container -->
        <div id="toast-container" class="fixed bottom-4 right-4 z-50 space-y-2"></div>

        <script src="auth.js"></script>
        <script src="app.js"></script>
        <script src="onboarding.js"></script>
</body>

</html>